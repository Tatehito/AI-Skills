---
name: gh-issue-create
description: ユーザーが入力した要件をもとに、github issueにissueを追加する
---

# GitHub Issue 作成

## 概要

- このスキルはユーザーとの対話を通じて要件を引き出し、GitHub Issueを作成します。
- カレントディレクトリのGitリポジトリに対してIssueを作成します。
- 要件の規模や内容に応じて、複数のIssueに分割することを検討します。
- GitHub操作にはMCPサーバーのツール（`mcp__MCP_DOCKER__issue_write`）を使用します。
- 質問は必ずUserAskQuestion機能を使用します。

## Input

- ユーザーからの要件・アイデア・バグ報告などの自由記述

## Output

- GitHub Issue（MCPサーバー経由で作成）

## 前提条件

- カレントディレクトリがGitリポジトリであること
- リモートリポジトリがGitHubであること
- GitHub MCPサーバーが利用可能であること

## ルール

- **ユーザーの明示的な承認なしにIssueを作成してはならない（最重要）**
  - Issueドラフトを提示し、ユーザーが「作成して」「OK」等の明確な承認を返すまで絶対に `issue_write` を呼ばない
  - 曖昧な反応（「いいと思う」等）の場合は「作成してよいですか？」と再確認する
- **対話で要件を引き出す**（ユーザーの曖昧な入力を明確なIssueに変換する）
- **シンプルに保つ**（タイトルと説明のみ。ラベルやアサインは不要）
- **ユーザーの言葉を尊重する**（過度な書き換えをしない）
- **適切に分割する**（1つのIssueが複数の独立した作業を含む場合は分割を提案する）
- **タイトルはユーザーストーリー形式**で作成する

## Issueタイトルのフォーマット

タイトルは以下の形式で記述する：

```
[ユーザー種別]は[実現できること]ができる
```

例:
- 「管理者はユーザー一覧をCSVでエクスポートできる」
- 「利用者はパスワードをリセットできる」
- 「開発者はエラーログを構造化された形式で確認できる」

## Issue分割の判断基準

以下のいずれかに該当する場合、複数のIssueへの分割を検討する：

- **独立した作業が複数含まれる**: 並行して別々に進められる作業がある
- **異なるユーザーストーリーに分解できる**: 「誰が」「何を」が異なる要件が混在している
- **段階的にリリース可能**: 一部だけ先に完成させて価値を届けられる
- **規模が大きい**: 1つのIssueとして扱うには範囲が広すぎる

分割しない場合：
- 要件が単一の作業で完結する
- 分割すると意味が失われる密結合な要件

## Epicブランチの検討

複数のIssueに分割するほど規模が大きい場合、epicブランチの作成を提案する。

- epicブランチは各Issueの作業ブランチのマージ先となるブランチ
- ブランチ名: `epic/[機能名]`（例: `epic/user-export`, `epic/auth-redesign`）
- 各Issueの作業ブランチはepicブランチから切り、epicブランチにマージする
- 全Issueの作業が完了したら、epicブランチをメインブランチにマージする

### epicブランチを作る基準

- 複数のIssueに分割され、それらが同じ大きな機能に属している
- メインブランチに段階的にマージすると中途半端な状態になる恐れがある

### epicブランチを作らない基準

- Issueが1つだけ
- 分割したIssueがそれぞれ独立しており、個別にメインブランチへマージしても問題ない

## 親Issue + Sub-issues（Epic管理）

複数のIssueに分割し、epicブランチを作成する場合は、**親Issue + Sub-issues**で管理する。

### 親Issueの作成

- epicの全体像を示す親Issueを作成する
- タイトルは機能全体を表すユーザーストーリー形式にする
- 本文には概要、技術方針、epicブランチ名、Sub-issuesの一覧を記載する

### Sub-issuesの紐づけ

分割した各IssueをSub-issuesとして親Issueに紐づける。GitHub APIを使用する：

```bash
# 子IssueのIDを取得してSub-issueとして追加
SUB_ID=$(gh api repos/{owner}/{repo}/issues/{child_number} --jq '.id')
gh api repos/{owner}/{repo}/issues/{parent_number}/sub_issues --input - <<< "{\"sub_issue_id\": $SUB_ID}"
```

### 運用ルール

- 親Issueには `epic` ラベルを付ける（ラベルが未作成の場合は `gh label create "epic" --description "複数のSub-issuesを束ねる親Issue" --color "7B68EE"` で作成する）
- 全Sub-issuesの作業が完了したら、epicブランチをmainにマージし、親Issueをクローズする
- 親Issueの進捗はSub-issuesの完了数で自動的に可視化される

## 実行手順

このスキルは**対話型**です。各ステップでユーザーに質問し、要件を明確にしてからIssueを作成します。

### 1. リポジトリの確認

- カレントディレクトリがGitリポジトリか確認する
- リモートのGitHubリポジトリ情報を取得する（`git remote get-url origin` からowner/repoを抽出）
- リポジトリが見つからない場合はユーザーに通知して終了する

### 2. 要件のヒアリング

- ユーザーの入力から「何を実現したいか」を理解する
- 不明点があれば質問して明確にする
  - 例: 「これはバグ修正ですか？新機能ですか？」
  - 例: 「もう少し具体的に教えてもらえますか？」
  - 例: 「誰がこの機能を使いますか？」
- 1〜2回の質問で十分な情報を集める（質問しすぎない）

### 3. 分割の検討

- 要件を分析し、複数のIssueに分割すべきか判断する
- 分割する場合はユーザーに分割案を提示し、確認を取る
- 分割しない場合はそのまま次のステップへ
- 分割する場合、epicブランチが必要かも合わせて検討・提案する

### 4. Issueドラフトの作成

各Issueについて以下を作成する：

- タイトル: ユーザーストーリー形式（上記フォーマット参照）
- 本文: 以下の構成で整理する
  ```
  ## 概要
  [要件の要約]

  ## 詳細
  [具体的な内容・背景]
  ```

### 5. ユーザーへの確認

- 作成するIssue（単数または複数）のタイトルと本文をユーザーに提示する
- フィードバックがあれば反映する
- 承認を得たら次のステップへ進む

### 6. Issue作成

- MCPサーバーの `mcp__MCP_DOCKER__issue_write` ツールを使用してIssueを作成する
  - method: "create"
  - owner: リポジトリオーナー
  - repo: リポジトリ名
  - title: ユーザーストーリー形式のタイトル
  - body: Issue本文
- 複数Issueの場合は順番に作成する
- 作成結果をユーザーに共有する

### 7. Sub-issuesの紐づけ（Epic管理の場合）

epicブランチを作成した場合、以下を実行する：

- 親Issueを作成する（epicの全体像を示す）
- ステップ6で作成した各Issueを親IssueのSub-issuesとして紐づける（GitHub API使用）
- 親IssueのURLをユーザーに共有する
